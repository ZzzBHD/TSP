clear
close all
clc
C=[2 4;
6 1;
14 12;
2 5;
12 14;
22 5;
1 7;
5 8;
21 35];
NC_max=100;
m=18;
Alpha=1;
Beta=5;
Rho=0.5;
Q=1;
%%-------------------------------------------------------------------------
%% ä¸»è¦ç¬¦å·è¯´æ˜
%% C nä¸ªåŸå¸‚çš„åæ ‡ï¼ŒnÃ—2çš„çŸ©é˜?%% NC_max æœ?¤§è¿­ä»£æ¬¡æ•°
%% m èš‚èšä¸ªæ•°
%% Alpha è¡¨å¾ä¿¡æ¯ç´ é‡è¦ç¨‹åº¦çš„å‚æ•°
%% Beta è¡¨å¾å¯å‘å¼å› å­é‡è¦ç¨‹åº¦çš„å‚æ•°
%% Rho ä¿¡æ¯ç´ è’¸å‘ç³»æ•?%% Q ä¿¡æ¯ç´ å¢åŠ å¼ºåº¦ç³»æ•?%% R_best å„ä»£æœ?½³è·¯çº¿
%% L_best å„ä»£æœ?½³è·¯çº¿çš„é•¿åº?%%=========================================================================
 %%ç¬¬ä¸€æ­¥ï¼šå˜é‡åˆå§‹åŒ?n=size(C,1);%nè¡¨ç¤ºé—®é¢˜çš„è§„æ¨¡ï¼ˆåŸå¸‚ä¸ªæ•°ï¼?D=zeros(n,n);%Dè¡¨ç¤ºå®Œå…¨å›¾çš„èµ‹æƒé‚»æ¥çŸ©é˜µ
for i=1:n
    for j=1:n
        if i~=j
            D(i,j)=((C(i,1)-C(j,1))^2+(C(i,2)-C(j,2))^2)^0.5;
        else
            D(i,j)=eps;      %i=jæ—¶ä¸è®¡ç®—ï¼Œåº”è¯¥ä¸º0ï¼Œä½†åé¢çš„å¯å‘å› å­è¦å–å?æ•°ï¼Œç”¨epsï¼ˆæµ®ç‚¹ç›¸å¯¹ç²¾åº¦ï¼‰è¡¨ç¤º
        end
        D(j,i)=D(i,j);   %å¯¹ç§°çŸ©é˜µ
    end
end
Eta=1./D;          %Etaä¸ºå¯å‘å› å­ï¼Œè¿™é‡Œè®¾ä¸ºè·ç¦»çš„å?æ•?Tau=ones(n,n);     %Tauä¸ºä¿¡æ¯ç´ çŸ©é˜µ
Tabu=zeros(m,n);   %å­˜å‚¨å¹¶è®°å½•è·¯å¾„çš„ç”Ÿæˆ
NC=1;               %è¿­ä»£è®¡æ•°å™¨ï¼Œè®°å½•è¿­ä»£æ¬¡æ•°
R_best=zeros(NC_max,n);       %å„ä»£æœ?½³è·¯çº¿
L_best=inf.*ones(NC_max,1);   %å„ä»£æœ?½³è·¯çº¿çš„é•¿åº?L_ave=zeros(NC_max,1); %å„ä»£è·¯çº¿çš„å¹³å‡é•¿åº?while NC<=NC_max        %åœæ­¢æ¡ä»¶ä¹‹ä¸€ï¼šè¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œåœæ­¢
    %%ç¬¬äºŒæ­¥ï¼šå°†måªèš‚èšæ”¾åˆ°nä¸ªåŸå¸‚ä¸Š
        Randpos=[];   %éšæœºå­˜å–
    for i=1:(ceil(m/n))
        Randpos=[Randpos,randperm(n)];
    end
    Tabu(:,1)=(Randpos(1,1:m))'; %æ­¤å¥ä¸å¤ªç†è§£ï¼?    
    %%ç¬¬ä¸‰æ­¥ï¼šmåªèš‚èšæŒ‰æ¦‚ç‡å‡½æ•°é€‰æ‹©ä¸‹ä¸€åº§åŸå¸‚ï¼Œå®Œæˆå„è‡ªçš„å‘¨æ¸?    for j=2:n     %æ‰?œ¨åŸå¸‚ä¸è®¡ç®?        for i=1:m
            visited=Tabu(i,1:(j-1)); %è®°å½•å·²è®¿é—®çš„åŸå¸‚ï¼Œé¿å…é‡å¤è®¿é—?            J=zeros(1,(n-j+1));       %å¾…è®¿é—®çš„åŸå¸‚
            P=J;                      %å¾…è®¿é—®åŸå¸‚çš„é€‰æ‹©æ¦‚ç‡åˆ†å¸ƒ
            Jc=1;
            for k=1:n
                if length(find(visited==k))==0   %å¼?§‹æ—¶ç½®0
                    J(Jc)=k;
                    Jc=Jc+1;                         %è®¿é—®çš„åŸå¸‚ä¸ªæ•°è‡ªåŠ?
                end
            end
            %ä¸‹é¢è®¡ç®—å¾…é?åŸå¸‚çš„æ¦‚ç‡åˆ†å¸?            for k=1:length(J)
                P(k)=(Tau(visited(end),J(k))^Alpha)*(Eta(visited(end),J(k))^Beta);
            end
            P=P/(sum(P));
            %æŒ‰æ¦‚ç‡åŸåˆ™é?å–ä¸‹ä¸?¸ªåŸå¸‚
            Pcum=cumsum(P);     %cumsumï¼Œå…ƒç´ ç´¯åŠ å³æ±‚å’Œ
            Select=find(Pcum>=rand); %è‹¥è®¡ç®—çš„æ¦‚ç‡å¤§äºåŸæ¥çš„å°±é€‰æ‹©è¿™æ¡è·¯çº¿
            to_visit=J(Select(1));
            Tabu(i,j)=to_visit;
        end
    end
    if NC>=2
        Tabu(1,:)=R_best(NC-1,:);
    end

    %%ç¬¬å››æ­¥ï¼šè®°å½•æœ¬æ¬¡è¿­ä»£æœ?½³è·¯çº¿
    L=zeros(m,1);     %å¼?§‹è·ç¦»ä¸?ï¼Œm*1çš„åˆ—å‘é‡
    for i=1:m
        R=Tabu(i,:);
        for j=1:(n-1)
            L(i)=L(i)+D(R(j),R(j+1));    %åŸè·ç¦»åŠ ä¸Šç¬¬jä¸ªåŸå¸‚åˆ°ç¬¬j+1ä¸ªåŸå¸‚çš„è·ç¦»
        end
        L(i)=L(i)+D(R(1),R(n));      %ä¸?½®ä¸‹æ¥åèµ°è¿‡çš„è·ç¦»
    end
    L_best(NC)=min(L);           %æœ?½³è·ç¦»å–æœ€å°?    pos=find(L==L_best(NC));
    R_best(NC,:)=Tabu(pos(1),:); %æ­¤è½®è¿­ä»£åçš„æœ?½³è·¯çº¿
    L_ave(NC)=mean(L);           %æ­¤è½®è¿­ä»£åçš„å¹³å‡è·ç¦»
    NC=NC+1;                      %è¿­ä»£ç»§ç»­


    %%ç¬¬äº”æ­¥ï¼šæ›´æ–°ä¿¡æ¯ç´?    Delta_Tau=zeros(n,n);        %å¼?§‹æ—¶ä¿¡æ¯ç´ ä¸ºn*nçš?çŸ©é˜µ
    for i=1:m
        for j=1:(n-1)
            Delta_Tau(Tabu(i,j),Tabu(i,j+1))=Delta_Tau(Tabu(i,j),Tabu(i,j+1))+Q/L(i);          
        %æ­¤æ¬¡å¾ªç¯åœ¨è·¯å¾„ï¼ˆiï¼Œjï¼‰ä¸Šçš„ä¿¡æ¯ç´ å¢é‡
        end
            Delta_Tau(Tabu(i,n),Tabu(i,1))=Delta_Tau(Tabu(i,n),Tabu(i,1))+Q/L(i);
        %æ­¤æ¬¡å¾ªç¯åœ¨æ•´ä¸ªè·¯å¾„ä¸Šçš„ä¿¡æ¯ç´ å¢é‡
    end
    Tau=(1-Rho).*Tau+Delta_Tau; %è€ƒè™‘ä¿¡æ¯ç´ æŒ¥å‘ï¼Œæ›´æ–°åçš„ä¿¡æ¯ç´?    %%ç¬¬å…­æ­¥ï¼šç¦å¿Œè¡¨æ¸…é›?    Tabu=zeros(m,n); %%ç›´åˆ°æœ?¤§è¿­ä»£æ¬¡æ•°
end
%%ç¬¬ä¸ƒæ­¥ï¼šè¾“å‡ºç»“æœ
Pos=find(L_best==min(L_best)); %æ‰¾åˆ°æœ?½³è·¯å¾„ï¼ˆé0ä¸ºçœŸï¼?Shortest_Route=R_best(Pos(1),:); %æœ?¤§è¿­ä»£æ¬¡æ•°åæœ€ä½³è·¯å¾?Shortest_Length=L_best(Pos(1)); %æœ?¤§è¿­ä»£æ¬¡æ•°åæœ€çŸ­è·ç¦?subplot(1,2,1);                  %ç»˜åˆ¶ç¬¬ä¸€ä¸ªå­å›¾å½¢
    %%=========================================================================
    %% DrawRoute.m
    %% ç”»è·¯çº¿å›¾çš„å­å‡½æ•°
    %%-------------------------------------------------------------------------
    %% C Coordinate èŠ‚ç‚¹åæ ‡ï¼Œç”±ä¸?¸ªNÃ—2çš„çŸ©é˜µå­˜å‚?    %% R Route è·¯çº¿
    %%=========================================================================

    N=length(R);
    scatter(C(:,1),C(:,2));
    hold on
    plot([C(R(1),1),C(R(N),1)],[C(R(1),2),C(R(N),2)],'g')
    hold on
    for ii=2:N
        plot([C(R(ii-1),1),C(R(ii),1)],[C(R(ii-1),2),C(R(ii),2)],'g')
        hold on
    end
    title('æ—…è¡Œå•†é—®é¢˜ä¼˜åŒ–ç»“æ?')

subplot(1,2,2);                  %ç»˜åˆ¶ç¬¬äºŒä¸ªå­å›¾å½¢

plot(L_best);
hold on ;                        %ä¿æŒå›¾å½¢
plot(L_ave,'r');
title('å¹³å‡è·ç¦»å’Œæœ€çŸ­è·ç¦?) ; %æ ‡é¢˜

